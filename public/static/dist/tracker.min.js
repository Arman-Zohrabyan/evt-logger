var TrackerBundle=function(t){"use strict";function e(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function n(t,e){let n;return function(...i){n||(t.apply(this,i),n=!0,setTimeout(()=>n=!1,e))}}class i{constructor(t,e,n=1e3){this.queue=[],this.sessionId=t,this.userId=e,this.maxSize=n}add(t,n){const i={id:e(),type:t,timestamp:Date.now(),sessionId:this.sessionId,userId:this.userId,data:n};if(this.queue.push(i),this.queue.length>this.maxSize){const t=this.queue.findIndex(t=>"rrweb_checkout"!==t.type);-1!==t?this.queue.splice(t,1):this.queue.shift()}}addRaw(t){this.queue.unshift(...t)}flush(){const t=[...this.queue];return this.queue=[],t}getAll(){return[...this.queue]}get length(){return this.queue.length}isEmpty(){return 0===this.queue.length}}const o="tracker_pending_events",s="tracker_user_identity",r="tracker_session_data",a=4194304;class c{static saveEvents(t){try{const e=JSON.stringify({events:t,timestamp:Date.now()});if(e.length>a){let n=[...t],i=e;for(;i.length>a&&n.length>1;)n.shift(),i=JSON.stringify({events:n,timestamp:Date.now()});return void localStorage.setItem(o,i)}localStorage.setItem(o,e)}catch(t){}}static getEvents(){try{const t=localStorage.getItem(o);if(!t)return[];const{events:e,timestamp:n}=JSON.parse(t);return Date.now()-n>864e5?(localStorage.removeItem(o),[]):e}catch(t){return[]}}static clearEvents(){try{localStorage.removeItem(o)}catch(t){}}static getUserIdentity(){try{const t=localStorage.getItem(s);return t?JSON.parse(t):null}catch(t){return null}}static setUserIdentity(t){try{localStorage.setItem(s,JSON.stringify(t))}catch(t){}}static incrementVisitCount(){const t=this.getUserIdentity();t&&(t.visitCount++,t.lastSeenAt=Date.now(),this.setUserIdentity(t))}static getSessionData(){try{const t=localStorage.getItem(r);return t?JSON.parse(t):null}catch(t){return null}}static setSessionData(t){try{localStorage.setItem(r,JSON.stringify(t))}catch(t){}}static updateSessionActivity(){const t=this.getSessionData();t&&(t.lastActivityAt=Date.now(),this.setSessionData(t))}static incrementPageViews(){const t=this.getSessionData();t&&(t.pageViews++,t.lastActivityAt=Date.now(),this.setSessionData(t))}static isSessionExpired(t=18e5){const e=this.getSessionData();if(!e)return!0;return Date.now()-e.lastActivityAt>t}static clearSession(){try{localStorage.removeItem(r)}catch(t){}}}class l{collect(){const t=navigator;return{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,languages:Array.from(navigator.languages||[]),cookieEnabled:navigator.cookieEnabled,deviceMemory:t.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency,screenWidth:screen.width,screenHeight:screen.height,availWidth:screen.availWidth,availHeight:screen.availHeight,colorDepth:screen.colorDepth,pixelRatio:window.devicePixelRatio,touchSupport:"ontouchstart"in window,maxTouchPoints:navigator.maxTouchPoints||0}}}class d{collect(){const t=navigator,e=t.connection||t.mozConnection||t.webkitConnection;return e?{type:e.type,effectiveType:e.effectiveType,downlink:e.downlink,rtt:e.rtt,saveData:e.saveData}:null}}class u{constructor(t="https://ipapi.co/json/"){this.ipEndpoint=t}async getGPSLocation(){return new Promise(t=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{t({type:"gps",latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy})},()=>t(null),{timeout:1e4}):t(null)})}async getIPLocation(){try{const t=await fetch(this.ipEndpoint),e=await t.json();return{type:"ip",latitude:e.latitude,longitude:e.longitude,country:e.country_name,city:e.city,ip:e.ip}}catch(t){return null}}}class h{collect(){if(!window.performance)return null;const t=performance.timing,e={loadTime:t.loadEventEnd-t.navigationStart,domContentLoaded:t.domContentLoadedEventEnd-t.navigationStart},n=performance.getEntriesByType("paint");for(const t of n)"first-paint"===t.name&&(e.firstPaint=t.startTime),"first-contentful-paint"===t.name&&(e.firstContentfulPaint=t.startTime);return e}}class g{constructor(t){this.handleVisibilityChange=()=>{this.callback({type:"visibility",state:document.visibilityState,timestamp:Date.now()})},this.handleFocus=()=>{this.callback({type:"focus",timestamp:Date.now()})},this.handleBlur=()=>{this.callback({type:"blur",timestamp:Date.now()})},this.callback=t}start(){document.addEventListener("visibilitychange",this.handleVisibilityChange),window.addEventListener("focus",this.handleFocus),window.addEventListener("blur",this.handleBlur)}stop(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),window.removeEventListener("focus",this.handleFocus),window.removeEventListener("blur",this.handleBlur)}}class m{constructor(t){this.battery=null,this.handleChange=()=>{this.callback(this.buildEvent("battery_change"))},this.callback=t}async collect(){const t=navigator;if(!t.getBattery)return null;try{return this.battery=await t.getBattery(),this.buildEvent("battery_status")}catch(t){return null}}start(){this.battery&&(this.battery.addEventListener("chargingchange",this.handleChange),this.battery.addEventListener("levelchange",this.handleChange),this.battery.addEventListener("chargingtimechange",this.handleChange),this.battery.addEventListener("dischargingtimechange",this.handleChange))}stop(){this.battery&&(this.battery.removeEventListener("chargingchange",this.handleChange),this.battery.removeEventListener("levelchange",this.handleChange),this.battery.removeEventListener("chargingtimechange",this.handleChange),this.battery.removeEventListener("dischargingtimechange",this.handleChange))}buildEvent(t){return{type:t,level:this.battery.level,charging:this.battery.charging,chargingTime:this.battery.chargingTime===1/0?null:this.battery.chargingTime,dischargingTime:this.battery.dischargingTime===1/0?null:this.battery.dischargingTime,timestamp:Date.now()}}}class p{constructor(t){this.handleOrientation=t=>{this.callback({type:"orientation",alpha:t.alpha,beta:t.beta,gamma:t.gamma,absolute:t.absolute,timestamp:Date.now()})},this.callback=t,this.throttledHandler=n(this.handleOrientation.bind(this),200)}start(){window.addEventListener("deviceorientation",this.throttledHandler)}stop(){window.removeEventListener("deviceorientation",this.throttledHandler)}}class I{constructor(t){this.handleMotion=t=>{this.callback({type:"motion",acceleration:t.acceleration?{x:t.acceleration.x,y:t.acceleration.y,z:t.acceleration.z}:null,accelerationIncludingGravity:t.accelerationIncludingGravity?{x:t.accelerationIncludingGravity.x,y:t.accelerationIncludingGravity.y,z:t.accelerationIncludingGravity.z}:null,rotationRate:t.rotationRate?{alpha:t.rotationRate.alpha,beta:t.rotationRate.beta,gamma:t.rotationRate.gamma}:null,interval:t.interval,timestamp:Date.now()})},this.callback=t,this.throttledHandler=n(this.handleMotion.bind(this),200)}start(){window.addEventListener("devicemotion",this.throttledHandler)}stop(){window.removeEventListener("devicemotion",this.throttledHandler)}}class C{constructor(t,e=3e4){this.activeTime=0,this.isActive=!0,this.reportInterval=null,this.handleVisibilityChange=()=>{"hidden"===document.visibilityState?this.markIdle():this.markActive()},this.handleFocus=()=>{this.markActive()},this.handleBlur=()=>{this.markIdle()},this.callback=t,this.pageLoadTime=Date.now(),this.lastActiveStart=Date.now(),e>0&&(this.reportInterval=setInterval(()=>{this.callback(this.collect())},e))}start(){document.addEventListener("visibilitychange",this.handleVisibilityChange),window.addEventListener("focus",this.handleFocus),window.addEventListener("blur",this.handleBlur)}stop(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),window.removeEventListener("focus",this.handleFocus),window.removeEventListener("blur",this.handleBlur),this.reportInterval&&clearInterval(this.reportInterval)}collect(){const t=Date.now(),e=this.isActive?this.activeTime+(t-this.lastActiveStart):this.activeTime,n=t-this.pageLoadTime;return{type:"time_on_page",totalTime:n,activeTime:e,idleTime:n-e,timestamp:t}}markActive(){this.isActive||(this.isActive=!0,this.lastActiveStart=Date.now())}markIdle(){this.isActive&&(this.isActive=!1,this.activeTime+=Date.now()-this.lastActiveStart)}}class y{constructor(){this.permissionNames=[{key:"camera",name:"camera"},{key:"microphone",name:"microphone"},{key:"notifications",name:"notifications"},{key:"clipboardRead",name:"clipboard-read"},{key:"clipboardWrite",name:"clipboard-write"},{key:"geolocation",name:"geolocation"}]}async collect(){if(!navigator.permissions)return null;const t={};for(const{key:e,name:n}of this.permissionNames)try{const i=await navigator.permissions.query({name:n});t[e]=i.state}catch(n){t[e]="unsupported"}return t}}var f;function v(t){var e=null==t?void 0:t.host;return Boolean((null==e?void 0:e.shadowRoot)===t)}function b(t){return"[object ShadowRoot]"===Object.prototype.toString.call(t)}function S(t){try{var e=t.rules||t.cssRules;return e?((n=Array.from(e).map(A).join("")).includes(" background-clip: text;")&&!n.includes(" -webkit-background-clip: text;")&&(n=n.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),n):null}catch(t){return null}var n}function A(t){var e=t.cssText;if(function(t){return"styleSheet"in t}(t))try{e=S(t.styleSheet)||e}catch(t){}return e}!function(t){t[t.Document=0]="Document",t[t.DocumentType=1]="DocumentType",t[t.Element=2]="Element",t[t.Text=3]="Text",t[t.CDATA=4]="CDATA",t[t.Comment=5]="Comment"}(f||(f={}));var k=function(){function t(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}return t.prototype.getId=function(t){var e;if(!t)return-1;var n=null===(e=this.getMeta(t))||void 0===e?void 0:e.id;return null!=n?n:-1},t.prototype.getNode=function(t){return this.idNodeMap.get(t)||null},t.prototype.getIds=function(){return Array.from(this.idNodeMap.keys())},t.prototype.getMeta=function(t){return this.nodeMetaMap.get(t)||null},t.prototype.removeNodeFromMap=function(t){var e=this,n=this.getId(t);this.idNodeMap.delete(n),t.childNodes&&t.childNodes.forEach(function(t){return e.removeNodeFromMap(t)})},t.prototype.has=function(t){return this.idNodeMap.has(t)},t.prototype.hasNode=function(t){return this.nodeMetaMap.has(t)},t.prototype.add=function(t,e){var n=e.id;this.idNodeMap.set(n,t),this.nodeMetaMap.set(t,e)},t.prototype.replace=function(t,e){var n=this.getNode(t);if(n){var i=this.nodeMetaMap.get(n);i&&this.nodeMetaMap.set(e,i)}this.idNodeMap.set(t,e)},t.prototype.reset=function(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap},t}();function w(t){var e=t.maskInputOptions,n=t.tagName,i=t.type,o=t.value,s=t.maskInputFn,r=o||"";return(e[n.toLowerCase()]||e[i])&&(r=s?s(r):"*".repeat(r.length)),r}var M="__rrweb_original__";var T,E,N=1,R=new RegExp("[^a-z0-9-_:]");function O(){return N++}var L=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,D=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,F=/^(data:)([^,]*),(.*)/i;function x(t,e){return(t||"").replace(L,function(t,n,i,o,s,r){var a,c=i||s||r,l=n||o||"";if(!c)return t;if(!D.test(c))return"url(".concat(l).concat(c).concat(l,")");if(F.test(c))return"url(".concat(l).concat(c).concat(l,")");if("/"===c[0])return"url(".concat(l).concat((a=e,(a.indexOf("//")>-1?a.split("/").slice(0,3).join("/"):a.split("/")[0]).split("?")[0]+c)).concat(l,")");var d=e.split("/"),u=c.split("/");d.pop();for(var h=0,g=u;h<g.length;h++){var m=g[h];"."!==m&&(".."===m?d.pop():d.push(m))}return"url(".concat(l).concat(d.join("/")).concat(l,")")})}var B=/^[^ \t\n\r\u000c]+/,W=/^[, \t\n\r\u000c]+/;function V(t,e){if(!e||""===e.trim())return e;var n=t.createElement("a");return n.href=e,n.href}function G(t){return Boolean("svg"===t.tagName||t.ownerSVGElement)}function Z(){var t=document.createElement("a");return t.href="",t.href}function U(t,e,n,i){return"src"===n||"href"===n&&i&&("use"!==e||"#"!==i[0])||"xlink:href"===n&&i&&"#"!==i[0]?V(t,i):"background"!==n||!i||"table"!==e&&"td"!==e&&"th"!==e?"srcset"===n&&i?function(t,e){if(""===e.trim())return e;var n=0;function i(t){var i,o=t.exec(e.substring(n));return o?(i=o[0],n+=i.length,i):""}for(var o=[];i(W),!(n>=e.length);){var s=i(B);if(","===s.slice(-1))s=V(t,s.substring(0,s.length-1)),o.push(s);else{var r="";s=V(t,s);for(var a=!1;;){var c=e.charAt(n);if(""===c){o.push((s+r).trim());break}if(a)")"===c&&(a=!1);else{if(","===c){n+=1,o.push((s+r).trim());break}"("===c&&(a=!0)}r+=c,n+=1}}}return o.join(", ")}(t,i):"style"===n&&i?x(i,Z()):"object"===e&&"data"===n&&i?V(t,i):i:V(t,i)}function K(t,e,n){if(!t)return!1;if(t.nodeType!==t.ELEMENT_NODE)return!!n&&K(t.parentNode,e,n);for(var i=t.classList.length;i--;){var o=t.classList[i];if(e.test(o))return!0}return!!n&&K(t.parentNode,e,n)}function _(t,e,n){var i=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(null===i)return!1;if("string"==typeof e){if(i.classList.contains(e))return!0;if(i.closest(".".concat(e)))return!0}else if(K(i,e,!0))return!0;if(n){if(i.matches(n))return!0;if(i.closest(n))return!0}return!1}function q(t,e){var n=e.doc,i=e.mirror,o=e.blockClass,s=e.blockSelector,r=e.maskTextClass,a=e.maskTextSelector,c=e.inlineStylesheet,l=e.maskInputOptions,d=void 0===l?{}:l,u=e.maskTextFn,h=e.maskInputFn,g=e.dataURLOptions,m=void 0===g?{}:g,p=e.inlineImages,I=e.recordCanvas,C=e.keepIframeSrcFn,y=e.newlyAddedElement,v=void 0!==y&&y,b=function(t,e){if(!e.hasNode(t))return;var n=e.getId(t);return 1===n?void 0:n}(n,i);switch(t.nodeType){case t.DOCUMENT_NODE:return"CSS1Compat"!==t.compatMode?{type:f.Document,childNodes:[],compatMode:t.compatMode}:{type:f.Document,childNodes:[]};case t.DOCUMENT_TYPE_NODE:return{type:f.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId,rootId:b};case t.ELEMENT_NODE:return function(t,e){for(var n=e.doc,i=e.blockClass,o=e.blockSelector,s=e.inlineStylesheet,r=e.maskInputOptions,a=void 0===r?{}:r,c=e.maskInputFn,l=e.dataURLOptions,d=void 0===l?{}:l,u=e.inlineImages,h=e.recordCanvas,g=e.keepIframeSrcFn,m=e.newlyAddedElement,p=void 0!==m&&m,I=e.rootId,C=function(t,e,n){if("string"==typeof e){if(t.classList.contains(e))return!0}else for(var i=t.classList.length;i--;){var o=t.classList[i];if(e.test(o))return!0}return!!n&&t.matches(n)}(t,i,o),y=function(t){if(t instanceof HTMLFormElement)return"form";var e=t.tagName.toLowerCase().trim();return R.test(e)?"div":e}(t),v={},b=t.attributes.length,A=0;A<b;A++){var k=t.attributes[A];v[k.name]=U(n,y,k.name,k.value)}if("link"===y&&s){var N=Array.from(n.styleSheets).find(function(e){return e.href===t.href}),O=null;N&&(O=S(N)),O&&(delete v.rel,delete v.href,v._cssText=x(O,N.href))}if("style"===y&&t.sheet&&!(t.innerText||t.textContent||"").trim().length){(O=S(t.sheet))&&(v._cssText=x(O,Z()))}if("input"===y||"textarea"===y||"select"===y){var L=t.value,D=t.checked;"radio"!==v.type&&"checkbox"!==v.type&&"submit"!==v.type&&"button"!==v.type&&L?v.value=w({type:v.type,tagName:y,value:L,maskInputOptions:a,maskInputFn:c}):D&&(v.checked=D)}"option"===y&&(t.selected&&!a.select?v.selected=!0:delete v.selected);if("canvas"===y&&h)if("2d"===t.__context)(function(t){var e=t.getContext("2d");if(!e)return!0;for(var n=0;n<t.width;n+=50)for(var i=0;i<t.height;i+=50){var o=e.getImageData,s=M in o?o[M]:o;if(new Uint32Array(s.call(e,n,i,Math.min(50,t.width-n),Math.min(50,t.height-i)).data.buffer).some(function(t){return 0!==t}))return!1}return!0})(t)||(v.rr_dataURL=t.toDataURL(d.type,d.quality));else if(!("__context"in t)){var F=t.toDataURL(d.type,d.quality),B=document.createElement("canvas");B.width=t.width,B.height=t.height,F!==B.toDataURL(d.type,d.quality)&&(v.rr_dataURL=F)}if("img"===y&&u){T||(T=n.createElement("canvas"),E=T.getContext("2d"));var W=t,V=W.crossOrigin;W.crossOrigin="anonymous";var K=function(){try{T.width=W.naturalWidth,T.height=W.naturalHeight,E.drawImage(W,0,0),v.rr_dataURL=T.toDataURL(d.type,d.quality)}catch(t){console.warn("Cannot inline img src=".concat(W.currentSrc,"! Error: ").concat(t))}V?v.crossOrigin=V:W.removeAttribute("crossorigin")};W.complete&&0!==W.naturalWidth?K():W.onload=K}"audio"!==y&&"video"!==y||(v.rr_mediaState=t.paused?"paused":"played",v.rr_mediaCurrentTime=t.currentTime);p||(t.scrollLeft&&(v.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(v.rr_scrollTop=t.scrollTop));if(C){var _=t.getBoundingClientRect(),q=_.width,z=_.height;v={class:v.class,rr_width:"".concat(q,"px"),rr_height:"".concat(z,"px")}}"iframe"!==y||g(v.src)||(t.contentDocument||(v.rr_src=v.src),delete v.src);return{type:f.Element,tagName:y,attributes:v,childNodes:[],isSVG:G(t)||void 0,needBlock:C,rootId:I}}(t,{doc:n,blockClass:o,blockSelector:s,inlineStylesheet:c,maskInputOptions:d,maskInputFn:h,dataURLOptions:m,inlineImages:p,recordCanvas:I,keepIframeSrcFn:C,newlyAddedElement:v,rootId:b});case t.TEXT_NODE:return function(t,e){var n,i=e.maskTextClass,o=e.maskTextSelector,s=e.maskTextFn,r=e.rootId,a=t.parentNode&&t.parentNode.tagName,c=t.textContent,l="STYLE"===a||void 0,d="SCRIPT"===a||void 0;if(l&&c){try{t.nextSibling||t.previousSibling||(null===(n=t.parentNode.sheet)||void 0===n?void 0:n.cssRules)&&(c=(u=t.parentNode.sheet).cssRules?Array.from(u.cssRules).map(function(t){return t.cssText||""}).join(""):"")}catch(e){console.warn("Cannot get CSS styles from text's parentNode. Error: ".concat(e),t)}c=x(c,Z())}var u;d&&(c="SCRIPT_PLACEHOLDER");!l&&!d&&c&&_(t,i,o)&&(c=s?s(c):c.replace(/[\S]/g,"*"));return{type:f.Text,textContent:c||"",isStyle:l,rootId:r}}(t,{maskTextClass:r,maskTextSelector:a,maskTextFn:u,rootId:b});case t.CDATA_SECTION_NODE:return{type:f.CDATA,textContent:"",rootId:b};case t.COMMENT_NODE:return{type:f.Comment,textContent:t.textContent||"",rootId:b};default:return!1}}function z(t){return void 0===t?"":t.toLowerCase()}function P(t,e){var n,i=e.doc,o=e.mirror,s=e.blockClass,r=e.blockSelector,a=e.maskTextClass,c=e.maskTextSelector,l=e.skipChild,d=void 0!==l&&l,u=e.inlineStylesheet,h=void 0===u||u,g=e.maskInputOptions,m=void 0===g?{}:g,p=e.maskTextFn,I=e.maskInputFn,C=e.slimDOMOptions,y=e.dataURLOptions,S=void 0===y?{}:y,A=e.inlineImages,k=void 0!==A&&A,w=e.recordCanvas,M=void 0!==w&&w,T=e.onSerialize,E=e.onIframeLoad,N=e.iframeLoadTimeout,R=void 0===N?5e3:N,L=e.onStylesheetLoad,D=e.stylesheetLoadTimeout,F=void 0===D?5e3:D,x=e.keepIframeSrcFn,B=void 0===x?function(){return!1}:x,W=e.newlyAddedElement,V=void 0!==W&&W,G=e.preserveWhiteSpace,Z=void 0===G||G,U=q(t,{doc:i,mirror:o,blockClass:s,blockSelector:r,maskTextClass:a,maskTextSelector:c,inlineStylesheet:h,maskInputOptions:m,maskTextFn:p,maskInputFn:I,dataURLOptions:S,inlineImages:k,recordCanvas:M,keepIframeSrcFn:B,newlyAddedElement:V});if(!U)return console.warn(t,"not serialized"),null;n=o.hasNode(t)?o.getId(t):!function(t,e){if(e.comment&&t.type===f.Comment)return!0;if(t.type===f.Element){if(e.script&&("script"===t.tagName||"link"===t.tagName&&"preload"===t.attributes.rel&&"script"===t.attributes.as||"link"===t.tagName&&"prefetch"===t.attributes.rel&&"string"==typeof t.attributes.href&&t.attributes.href.endsWith(".js")))return!0;if(e.headFavicon&&("link"===t.tagName&&"shortcut icon"===t.attributes.rel||"meta"===t.tagName&&(z(t.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===z(t.attributes.name)||"icon"===z(t.attributes.rel)||"apple-touch-icon"===z(t.attributes.rel)||"shortcut icon"===z(t.attributes.rel))))return!0;if("meta"===t.tagName){if(e.headMetaDescKeywords&&z(t.attributes.name).match(/^description|keywords$/))return!0;if(e.headMetaSocial&&(z(t.attributes.property).match(/^(og|twitter|fb):/)||z(t.attributes.name).match(/^(og|twitter):/)||"pinterest"===z(t.attributes.name)))return!0;if(e.headMetaRobots&&("robots"===z(t.attributes.name)||"googlebot"===z(t.attributes.name)||"bingbot"===z(t.attributes.name)))return!0;if(e.headMetaHttpEquiv&&void 0!==t.attributes["http-equiv"])return!0;if(e.headMetaAuthorship&&("author"===z(t.attributes.name)||"generator"===z(t.attributes.name)||"framework"===z(t.attributes.name)||"publisher"===z(t.attributes.name)||"progid"===z(t.attributes.name)||z(t.attributes.property).match(/^article:/)||z(t.attributes.property).match(/^product:/)))return!0;if(e.headMetaVerification&&("google-site-verification"===z(t.attributes.name)||"yandex-verification"===z(t.attributes.name)||"csrf-token"===z(t.attributes.name)||"p:domain_verify"===z(t.attributes.name)||"verify-v1"===z(t.attributes.name)||"verification"===z(t.attributes.name)||"shopify-checkout-api-token"===z(t.attributes.name)))return!0}}return!1}(U,C)&&(Z||U.type!==f.Text||U.isStyle||U.textContent.replace(/^\s+|\s+$/gm,"").length)?O():-2;var K=Object.assign(U,{id:n});if(o.add(t,K),-2===n)return null;T&&T(t);var _=!d;if(K.type===f.Element){_=_&&!K.needBlock,delete K.needBlock;var Y=t.shadowRoot;Y&&b(Y)&&(K.isShadowHost=!0)}if((K.type===f.Document||K.type===f.Element)&&_){C.headWhitespace&&K.type===f.Element&&"head"===K.tagName&&(Z=!1);for(var J={doc:i,mirror:o,blockClass:s,blockSelector:r,maskTextClass:a,maskTextSelector:c,skipChild:d,inlineStylesheet:h,maskInputOptions:m,maskTextFn:p,maskInputFn:I,slimDOMOptions:C,dataURLOptions:S,inlineImages:k,recordCanvas:M,preserveWhiteSpace:Z,onSerialize:T,onIframeLoad:E,iframeLoadTimeout:R,onStylesheetLoad:L,stylesheetLoadTimeout:F,keepIframeSrcFn:B},Q=0,H=Array.from(t.childNodes);Q<H.length;Q++){($=P(H[Q],J))&&K.childNodes.push($)}if(function(t){return t.nodeType===t.ELEMENT_NODE}(t)&&t.shadowRoot)for(var j=0,X=Array.from(t.shadowRoot.childNodes);j<X.length;j++){var $;($=P(X[j],J))&&(b(t.shadowRoot)&&($.isShadow=!0),K.childNodes.push($))}}return t.parentNode&&v(t.parentNode)&&b(t.parentNode)&&(K.isShadow=!0),K.type===f.Element&&"iframe"===K.tagName&&function(t,e,n){var i=t.contentWindow;if(i){var o,s=!1;try{o=i.document.readyState}catch(t){return}if("complete"===o){var r="about:blank";if(i.location.href!==r||t.src===r||""===t.src)return setTimeout(e,0),t.addEventListener("load",e);t.addEventListener("load",e)}else{var a=setTimeout(function(){s||(e(),s=!0)},n);t.addEventListener("load",function(){clearTimeout(a),s=!0,e()})}}}(t,function(){var e=t.contentDocument;if(e&&E){var n=P(e,{doc:e,mirror:o,blockClass:s,blockSelector:r,maskTextClass:a,maskTextSelector:c,skipChild:!1,inlineStylesheet:h,maskInputOptions:m,maskTextFn:p,maskInputFn:I,slimDOMOptions:C,dataURLOptions:S,inlineImages:k,recordCanvas:M,preserveWhiteSpace:Z,onSerialize:T,onIframeLoad:E,iframeLoadTimeout:R,onStylesheetLoad:L,stylesheetLoadTimeout:F,keepIframeSrcFn:B});n&&E(t,n)}},R),K.type===f.Element&&"link"===K.tagName&&"stylesheet"===K.attributes.rel&&function(t,e,n){var i,o=!1;try{i=t.sheet}catch(t){return}if(!i){var s=setTimeout(function(){o||(e(),o=!0)},n);t.addEventListener("load",function(){clearTimeout(s),o=!0,e()})}}(t,function(){if(L){var e=P(t,{doc:i,mirror:o,blockClass:s,blockSelector:r,maskTextClass:a,maskTextSelector:c,skipChild:!1,inlineStylesheet:h,maskInputOptions:m,maskTextFn:p,maskInputFn:I,slimDOMOptions:C,dataURLOptions:S,inlineImages:k,recordCanvas:M,preserveWhiteSpace:Z,onSerialize:T,onIframeLoad:E,iframeLoadTimeout:R,onStylesheetLoad:L,stylesheetLoadTimeout:F,keepIframeSrcFn:B});e&&L(t,e)}},F),K}function Y(t,e,n=document){const i={capture:!0,passive:!0};return n.addEventListener(t,e,i),()=>n.removeEventListener(t,e,i)}const J="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";let Q={map:{},getId:()=>(console.error(J),-1),getNode:()=>(console.error(J),null),removeNodeFromMap(){console.error(J)},has:()=>(console.error(J),!1),reset(){console.error(J)}};function H(t,e,n={}){let i=null,o=0;return function(...s){const r=Date.now();o||!1!==n.leading||(o=r);const a=e-(r-o),c=this;a<=0||a>e?(i&&(clearTimeout(i),i=null),o=r,t.apply(c,s)):i||!1===n.trailing||(i=setTimeout(()=>{o=!1===n.leading?0:Date.now(),i=null,t.apply(c,s)},a))}}function j(t,e,n,i,o=window){const s=o.Object.getOwnPropertyDescriptor(t,e);return o.Object.defineProperty(t,e,i?n:{set(t){setTimeout(()=>{n.set.call(this,t)},0),s&&s.set&&s.set.call(this,t)}}),()=>j(t,e,s||{},!0)}function X(t,e,n){try{if(!(e in t))return()=>{};const i=t[e],o=n(i);return"function"==typeof o&&(o.prototype=o.prototype||{},Object.defineProperties(o,{__rrweb_original__:{enumerable:!1,value:i}})),t[e]=o,()=>{t[e]=i}}catch(t){return()=>{}}}function $(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function tt(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function et(t,e,n,i){if(!t)return!1;const o=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(!o)return!1;if("string"==typeof e){if(o.classList.contains(e))return!0;if(i&&null!==o.closest("."+e))return!0}else if(K(o,e,i))return!0;if(n){if(t.matches(n))return!0;if(i&&null!==o.closest(n))return!0}return!1}function nt(t,e){return-2===e.getId(t)}function it(t,e){if(v(t))return!1;const n=e.getId(t);return!e.has(n)||(!t.parentNode||t.parentNode.nodeType!==t.DOCUMENT_NODE)&&(!t.parentNode||it(t.parentNode,e))}function ot(t){return Boolean(t.changedTouches)}function st(t,e){return Boolean("IFRAME"===t.nodeName&&e.getMeta(t))}function rt(t,e){return Boolean("LINK"===t.nodeName&&t.nodeType===t.ELEMENT_NODE&&t.getAttribute&&"stylesheet"===t.getAttribute("rel")&&e.getMeta(t))}function at(t){return Boolean(null==t?void 0:t.shadowRoot)}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(Q=new Proxy(Q,{get:(t,e,n)=>("map"===e&&console.error(J),Reflect.get(t,e,n))}));class ct{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(t){var e;return null!==(e=this.styleIDMap.get(t))&&void 0!==e?e:-1}has(t){return this.styleIDMap.has(t)}add(t,e){if(this.has(t))return this.getId(t);let n;return n=void 0===e?this.id++:e,this.styleIDMap.set(t,n),this.idStyleMap.set(n,t),n}getStyle(t){return this.idStyleMap.get(t)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}var lt=(t=>(t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t))(lt||{}),dt=(t=>(t[t.Mutation=0]="Mutation",t[t.MouseMove=1]="MouseMove",t[t.MouseInteraction=2]="MouseInteraction",t[t.Scroll=3]="Scroll",t[t.ViewportResize=4]="ViewportResize",t[t.Input=5]="Input",t[t.TouchMove=6]="TouchMove",t[t.MediaInteraction=7]="MediaInteraction",t[t.StyleSheetRule=8]="StyleSheetRule",t[t.CanvasMutation=9]="CanvasMutation",t[t.Font=10]="Font",t[t.Log=11]="Log",t[t.Drag=12]="Drag",t[t.StyleDeclaration=13]="StyleDeclaration",t[t.Selection=14]="Selection",t[t.AdoptedStyleSheet=15]="AdoptedStyleSheet",t))(dt||{}),ut=(t=>(t[t.MouseUp=0]="MouseUp",t[t.MouseDown=1]="MouseDown",t[t.Click=2]="Click",t[t.ContextMenu=3]="ContextMenu",t[t.DblClick=4]="DblClick",t[t.Focus=5]="Focus",t[t.Blur=6]="Blur",t[t.TouchStart=7]="TouchStart",t[t.TouchMove_Departed=8]="TouchMove_Departed",t[t.TouchEnd=9]="TouchEnd",t[t.TouchCancel=10]="TouchCancel",t))(ut||{}),ht=(t=>(t[t["2D"]=0]="2D",t[t.WebGL=1]="WebGL",t[t.WebGL2=2]="WebGL2",t))(ht||{});function gt(t){return"__ln"in t}class mt{constructor(){this.length=0,this.head=null}get(t){if(t>=this.length)throw new Error("Position outside of list range");let e=this.head;for(let n=0;n<t;n++)e=(null==e?void 0:e.next)||null;return e}addNode(t){const e={value:t,previous:null,next:null};if(t.__ln=e,t.previousSibling&&gt(t.previousSibling)){const n=t.previousSibling.__ln.next;e.next=n,e.previous=t.previousSibling.__ln,t.previousSibling.__ln.next=e,n&&(n.previous=e)}else if(t.nextSibling&&gt(t.nextSibling)&&t.nextSibling.__ln.previous){const n=t.nextSibling.__ln.previous;e.previous=n,e.next=t.nextSibling.__ln,t.nextSibling.__ln.previous=e,n&&(n.next=e)}else this.head&&(this.head.previous=e),e.next=this.head,this.head=e;this.length++}removeNode(t){const e=t.__ln;this.head&&(e.previous?(e.previous.next=e.next,e.next&&(e.next.previous=e.previous)):(this.head=e.next,this.head&&(this.head.previous=null)),t.__ln&&delete t.__ln,this.length--)}}const pt=(t,e)=>`${t}@${e}`;class It{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=t=>{t.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const t=[],e=new mt,n=t=>{let e=t,n=-2;for(;-2===n;)e=e&&e.nextSibling,n=e&&this.mirror.getId(e);return n},i=i=>{var o,s,r,a;let c=null;(null===(s=null===(o=i.getRootNode)||void 0===o?void 0:o.call(i))||void 0===s?void 0:s.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&i.getRootNode().host&&(c=i.getRootNode().host);let l=c;for(;(null===(a=null===(r=null==l?void 0:l.getRootNode)||void 0===r?void 0:r.call(l))||void 0===a?void 0:a.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&l.getRootNode().host;)l=l.getRootNode().host;const d=!(this.doc.contains(i)||l&&this.doc.contains(l));if(!i.parentNode||d)return;const u=v(i.parentNode)?this.mirror.getId(c):this.mirror.getId(i.parentNode),h=n(i);if(-1===u||-1===h)return e.addNode(i);const g=P(i,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:t=>{st(t,this.mirror)&&this.iframeManager.addIframe(t),rt(t,this.mirror)&&this.stylesheetManager.trackLinkElement(t),at(i)&&this.shadowDomManager.addShadowRoot(i.shadowRoot,this.doc)},onIframeLoad:(t,e)=>{this.iframeManager.attachIframe(t,e),this.shadowDomManager.observeAttachShadow(t)},onStylesheetLoad:(t,e)=>{this.stylesheetManager.attachLinkElement(t,e)}});g&&t.push({parentId:u,nextId:h,node:g})};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const t of Array.from(this.movedSet.values()))yt(this.removes,t,this.mirror)&&!this.movedSet.has(t.parentNode)||i(t);for(const t of Array.from(this.addedSet.values()))vt(this.droppedSet,t)||yt(this.removes,t,this.mirror)?vt(this.movedSet,t)?i(t):this.droppedSet.add(t):i(t);let o=null;for(;e.length;){let t=null;if(o){const e=this.mirror.getId(o.value.parentNode),i=n(o.value);-1!==e&&-1!==i&&(t=o)}if(!t)for(let i=e.length-1;i>=0;i--){const o=e.get(i);if(o){const e=this.mirror.getId(o.value.parentNode);if(-1===n(o.value))continue;if(-1!==e){t=o;break}{const e=o.value;if(e.parentNode&&e.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const n=e.parentNode.host;if(-1!==this.mirror.getId(n)){t=o;break}}}}}if(!t){for(;e.head;)e.removeNode(e.head.value);break}o=t.previous,e.removeNode(t.value),i(t.value)}const s={texts:this.texts.map(t=>({id:this.mirror.getId(t.node),value:t.value})).filter(t=>this.mirror.has(t.id)),attributes:this.attributes.map(t=>({id:this.mirror.getId(t.node),attributes:t.attributes})).filter(t=>this.mirror.has(t.id)),removes:this.removes,adds:t};(s.texts.length||s.attributes.length||s.removes.length||s.adds.length)&&(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(s))},this.processMutation=t=>{if(!nt(t.target,this.mirror))switch(t.type){case"characterData":{const e=t.target.textContent;et(t.target,this.blockClass,this.blockSelector,!1)||e===t.oldValue||this.texts.push({value:_(t.target,this.maskTextClass,this.maskTextSelector)&&e?this.maskTextFn?this.maskTextFn(e):e.replace(/[\S]/g,"*"):e,node:t.target});break}case"attributes":{const e=t.target;let n=t.target.getAttribute(t.attributeName);if("value"===t.attributeName&&(n=w({maskInputOptions:this.maskInputOptions,tagName:t.target.tagName,type:t.target.getAttribute("type"),value:n,maskInputFn:this.maskInputFn})),et(t.target,this.blockClass,this.blockSelector,!1)||n===t.oldValue)return;let i=this.attributes.find(e=>e.node===t.target);if("IFRAME"===e.tagName&&"src"===t.attributeName&&!this.keepIframeSrcFn(n)){if(e.contentDocument)return;t.attributeName="rr_src"}if(i||(i={node:t.target,attributes:{}},this.attributes.push(i)),"style"===t.attributeName){const n=this.doc.createElement("span");t.oldValue&&n.setAttribute("style",t.oldValue),void 0!==i.attributes.style&&null!==i.attributes.style||(i.attributes.style={});const o=i.attributes.style;for(const t of Array.from(e.style)){const i=e.style.getPropertyValue(t),s=e.style.getPropertyPriority(t);i===n.style.getPropertyValue(t)&&s===n.style.getPropertyPriority(t)||(o[t]=""===s?i:[i,s])}for(const t of Array.from(n.style))""===e.style.getPropertyValue(t)&&(o[t]=!1)}else i.attributes[t.attributeName]=U(this.doc,e.tagName,t.attributeName,n);break}case"childList":if(et(t.target,this.blockClass,this.blockSelector,!0))return;t.addedNodes.forEach(e=>this.genAdds(e,t.target)),t.removedNodes.forEach(e=>{const n=this.mirror.getId(e),i=v(t.target)?this.mirror.getId(t.target.host):this.mirror.getId(t.target);et(t.target,this.blockClass,this.blockSelector,!1)||nt(e,this.mirror)||!function(t,e){return-1!==e.getId(t)}(e,this.mirror)||(this.addedSet.has(e)?(Ct(this.addedSet,e),this.droppedSet.add(e)):this.addedSet.has(t.target)&&-1===n||it(t.target,this.mirror)||(this.movedSet.has(e)&&this.movedMap[pt(n,i)]?Ct(this.movedSet,e):this.removes.push({parentId:i,id:n,isShadow:!(!v(t.target)||!b(t.target))||void 0})),this.mapRemoves.push(e))})}},this.genAdds=(t,e)=>{if(this.mirror.hasNode(t)){if(nt(t,this.mirror))return;this.movedSet.add(t);let n=null;e&&this.mirror.hasNode(e)&&(n=this.mirror.getId(e)),n&&-1!==n&&(this.movedMap[pt(this.mirror.getId(t),n)]=!0)}else this.addedSet.add(t),this.droppedSet.delete(t);et(t,this.blockClass,this.blockSelector,!1)||t.childNodes.forEach(t=>this.genAdds(t))}}init(t){["mutationCb","blockClass","blockSelector","maskTextClass","maskTextSelector","inlineStylesheet","maskInputOptions","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager"].forEach(e=>{this[e]=t[e]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function Ct(t,e){t.delete(e),e.childNodes.forEach(e=>Ct(t,e))}function yt(t,e,n){return 0!==t.length&&ft(t,e,n)}function ft(t,e,n){const{parentNode:i}=e;if(!i)return!1;const o=n.getId(i);return!!t.some(t=>t.id===o)||ft(t,i,n)}function vt(t,e){return 0!==t.size&&bt(t,e)}function bt(t,e){const{parentNode:n}=e;return!!n&&(!!t.has(n)||bt(t,n))}const St=[],At="undefined"!=typeof CSSGroupingRule,kt="undefined"!=typeof CSSMediaRule,wt="undefined"!=typeof CSSSupportsRule,Mt="undefined"!=typeof CSSConditionRule;function Tt(t){try{if("composedPath"in t){const e=t.composedPath();if(e.length)return e[0]}else if("path"in t&&t.path.length)return t.path[0];return t.target}catch(e){return t.target}}function Et(t,e){var n,i;const o=new It;St.push(o),o.init(t);let s=window.MutationObserver||window.__rrMutationObserver;const r=null===(i=null===(n=null===window||void 0===window?void 0:window.Zone)||void 0===n?void 0:n.__symbol__)||void 0===i?void 0:i.call(n,"MutationObserver");r&&window[r]&&(s=window[r]);const a=new s(o.processMutations.bind(o));return a.observe(e,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),a}function Nt({mouseInteractionCb:t,doc:e,mirror:n,blockClass:i,blockSelector:o,sampling:s}){if(!1===s.mouseInteraction)return()=>{};const r=!0===s.mouseInteraction||void 0===s.mouseInteraction?{}:s.mouseInteraction,a=[];return Object.keys(ut).filter(t=>Number.isNaN(Number(t))&&!t.endsWith("_Departed")&&!1!==r[t]).forEach(s=>{const r=s.toLowerCase(),c=(e=>s=>{const r=Tt(s);if(et(r,i,o,!0))return;const a=ot(s)?s.changedTouches[0]:s;if(!a)return;const c=n.getId(r),{clientX:l,clientY:d}=a;t({type:ut[e],id:c,x:l,y:d})})(s);a.push(Y(r,c,e))}),()=>{a.forEach(t=>t())}}function Rt({scrollCb:t,doc:e,mirror:n,blockClass:i,blockSelector:o,sampling:s}){return Y("scroll",H(s=>{const r=Tt(s);if(!r||et(r,i,o,!0))return;const a=n.getId(r);if(r===e){const n=e.scrollingElement||e.documentElement;t({id:a,x:n.scrollLeft,y:n.scrollTop})}else t({id:a,x:r.scrollLeft,y:r.scrollTop})},s.scroll||100),e)}function Ot(t,e){const n=Object.assign({},t);return e||delete n.userTriggered,n}const Lt=["INPUT","TEXTAREA","SELECT"],Dt=new WeakMap;function Ft(t){return function(t,e){if(At&&t.parentRule instanceof CSSGroupingRule||kt&&t.parentRule instanceof CSSMediaRule||wt&&t.parentRule instanceof CSSSupportsRule||Mt&&t.parentRule instanceof CSSConditionRule){const n=Array.from(t.parentRule.cssRules).indexOf(t);e.unshift(n)}else if(t.parentStyleSheet){const n=Array.from(t.parentStyleSheet.cssRules).indexOf(t);e.unshift(n)}return e}(t,[])}function xt(t,e,n){let i,o;return t?(t.ownerNode?i=e.getId(t.ownerNode):o=n.getId(t),{styleId:o,id:i}):{}}function Bt({mirror:t,stylesheetManager:e},n){var i,o,s;let r=null;r="#document"===n.nodeName?t.getId(n):t.getId(n.host);const a="#document"===n.nodeName?null===(i=n.defaultView)||void 0===i?void 0:i.Document:null===(s=null===(o=n.ownerDocument)||void 0===o?void 0:o.defaultView)||void 0===s?void 0:s.ShadowRoot,c=Object.getOwnPropertyDescriptor(null==a?void 0:a.prototype,"adoptedStyleSheets");return null!==r&&-1!==r&&a&&c?(Object.defineProperty(n,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get(){var t;return null===(t=c.get)||void 0===t?void 0:t.call(this)},set(t){var n;const i=null===(n=c.set)||void 0===n?void 0:n.call(this,t);if(null!==r&&-1!==r)try{e.adoptStyleSheets(t,r)}catch(t){}return i}}),()=>{Object.defineProperty(n,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get:c.get,set:c.set})}):()=>{}}function Wt(t,e={}){const n=t.doc.defaultView;if(!n)return()=>{};!function(t,e){const{mutationCb:n,mousemoveCb:i,mouseInteractionCb:o,scrollCb:s,viewportResizeCb:r,inputCb:a,mediaInteractionCb:c,styleSheetRuleCb:l,styleDeclarationCb:d,canvasMutationCb:u,fontCb:h,selectionCb:g}=t;t.mutationCb=(...t)=>{e.mutation&&e.mutation(...t),n(...t)},t.mousemoveCb=(...t)=>{e.mousemove&&e.mousemove(...t),i(...t)},t.mouseInteractionCb=(...t)=>{e.mouseInteraction&&e.mouseInteraction(...t),o(...t)},t.scrollCb=(...t)=>{e.scroll&&e.scroll(...t),s(...t)},t.viewportResizeCb=(...t)=>{e.viewportResize&&e.viewportResize(...t),r(...t)},t.inputCb=(...t)=>{e.input&&e.input(...t),a(...t)},t.mediaInteractionCb=(...t)=>{e.mediaInteaction&&e.mediaInteaction(...t),c(...t)},t.styleSheetRuleCb=(...t)=>{e.styleSheetRule&&e.styleSheetRule(...t),l(...t)},t.styleDeclarationCb=(...t)=>{e.styleDeclaration&&e.styleDeclaration(...t),d(...t)},t.canvasMutationCb=(...t)=>{e.canvasMutation&&e.canvasMutation(...t),u(...t)},t.fontCb=(...t)=>{e.font&&e.font(...t),h(...t)},t.selectionCb=(...t)=>{e.selection&&e.selection(...t),g(...t)}}(t,e);const i=Et(t,t.doc),o=function({mousemoveCb:t,sampling:e,doc:n,mirror:i}){if(!1===e.mousemove)return()=>{};const o="number"==typeof e.mousemove?e.mousemove:50,s="number"==typeof e.mousemoveCallback?e.mousemoveCallback:500;let r,a=[];const c=H(e=>{const n=Date.now()-r;t(a.map(t=>(t.timeOffset-=n,t)),e),a=[],r=null},s),l=H(t=>{const e=Tt(t),{clientX:n,clientY:o}=ot(t)?t.changedTouches[0]:t;r||(r=Date.now()),a.push({x:n,y:o,id:i.getId(e),timeOffset:Date.now()-r}),c("undefined"!=typeof DragEvent&&t instanceof DragEvent?dt.Drag:t instanceof MouseEvent?dt.MouseMove:dt.TouchMove)},o,{trailing:!1}),d=[Y("mousemove",l,n),Y("touchmove",l,n),Y("drag",l,n)];return()=>{d.forEach(t=>t())}}(t),s=Nt(t),r=Rt(t),a=function({viewportResizeCb:t}){let e=-1,n=-1;return Y("resize",H(()=>{const i=$(),o=tt();e===i&&n===o||(t({width:Number(o),height:Number(i)}),e=i,n=o)},200),window)}(t),c=function({inputCb:t,doc:e,mirror:n,blockClass:i,blockSelector:o,ignoreClass:s,maskInputOptions:r,maskInputFn:a,sampling:c,userTriggeredOnInput:l}){function d(t){let n=Tt(t);const c=t.isTrusted;if(n&&"OPTION"===n.tagName&&(n=n.parentElement),!n||!n.tagName||Lt.indexOf(n.tagName)<0||et(n,i,o,!0))return;const d=n.type;if(n.classList.contains(s))return;let h=n.value,g=!1;"radio"===d||"checkbox"===d?g=n.checked:(r[n.tagName.toLowerCase()]||r[d])&&(h=w({maskInputOptions:r,tagName:n.tagName,type:d,value:h,maskInputFn:a})),u(n,Ot({text:h,isChecked:g,userTriggered:c},l));const m=n.name;"radio"===d&&m&&g&&e.querySelectorAll(`input[type="radio"][name="${m}"]`).forEach(t=>{t!==n&&u(t,Ot({text:t.value,isChecked:!g,userTriggered:!1},l))})}function u(e,i){const o=Dt.get(e);if(!o||o.text!==i.text||o.isChecked!==i.isChecked){Dt.set(e,i);const o=n.getId(e);t(Object.assign(Object.assign({},i),{id:o}))}}const h=("last"===c.input?["change"]:["input","change"]).map(t=>Y(t,d,e)),g=e.defaultView;if(!g)return()=>{h.forEach(t=>t())};const m=g.Object.getOwnPropertyDescriptor(g.HTMLInputElement.prototype,"value"),p=[[g.HTMLInputElement.prototype,"value"],[g.HTMLInputElement.prototype,"checked"],[g.HTMLSelectElement.prototype,"value"],[g.HTMLTextAreaElement.prototype,"value"],[g.HTMLSelectElement.prototype,"selectedIndex"],[g.HTMLOptionElement.prototype,"selected"]];return m&&m.set&&h.push(...p.map(t=>j(t[0],t[1],{set(){d({target:this})}},!1,g))),()=>{h.forEach(t=>t())}}(t),l=function({mediaInteractionCb:t,blockClass:e,blockSelector:n,mirror:i,sampling:o}){const s=s=>H(o=>{const r=Tt(o);if(!r||et(r,e,n,!0))return;const{currentTime:a,volume:c,muted:l,playbackRate:d}=r;t({type:s,id:i.getId(r),currentTime:a,volume:c,muted:l,playbackRate:d})},o.media||500),r=[Y("play",s(0)),Y("pause",s(1)),Y("seeked",s(2)),Y("volumechange",s(3)),Y("ratechange",s(4))];return()=>{r.forEach(t=>t())}}(t),d=function({styleSheetRuleCb:t,mirror:e,stylesheetManager:n},{win:i}){const o=i.CSSStyleSheet.prototype.insertRule;i.CSSStyleSheet.prototype.insertRule=function(i,s){const{id:r,styleId:a}=xt(this,e,n.styleMirror);return(r&&-1!==r||a&&-1!==a)&&t({id:r,styleId:a,adds:[{rule:i,index:s}]}),o.apply(this,[i,s])};const s=i.CSSStyleSheet.prototype.deleteRule;let r,a;i.CSSStyleSheet.prototype.deleteRule=function(i){const{id:o,styleId:r}=xt(this,e,n.styleMirror);return(o&&-1!==o||r&&-1!==r)&&t({id:o,styleId:r,removes:[{index:i}]}),s.apply(this,[i])},i.CSSStyleSheet.prototype.replace&&(r=i.CSSStyleSheet.prototype.replace,i.CSSStyleSheet.prototype.replace=function(i){const{id:o,styleId:s}=xt(this,e,n.styleMirror);return(o&&-1!==o||s&&-1!==s)&&t({id:o,styleId:s,replace:i}),r.apply(this,[i])}),i.CSSStyleSheet.prototype.replaceSync&&(a=i.CSSStyleSheet.prototype.replaceSync,i.CSSStyleSheet.prototype.replaceSync=function(i){const{id:o,styleId:s}=xt(this,e,n.styleMirror);return(o&&-1!==o||s&&-1!==s)&&t({id:o,styleId:s,replaceSync:i}),a.apply(this,[i])});const c={};At?c.CSSGroupingRule=i.CSSGroupingRule:(kt&&(c.CSSMediaRule=i.CSSMediaRule),Mt&&(c.CSSConditionRule=i.CSSConditionRule),wt&&(c.CSSSupportsRule=i.CSSSupportsRule));const l={};return Object.entries(c).forEach(([i,o])=>{l[i]={insertRule:o.prototype.insertRule,deleteRule:o.prototype.deleteRule},o.prototype.insertRule=function(o,s){const{id:r,styleId:a}=xt(this.parentStyleSheet,e,n.styleMirror);return(r&&-1!==r||a&&-1!==a)&&t({id:r,styleId:a,adds:[{rule:o,index:[...Ft(this),s||0]}]}),l[i].insertRule.apply(this,[o,s])},o.prototype.deleteRule=function(o){const{id:s,styleId:r}=xt(this.parentStyleSheet,e,n.styleMirror);return(s&&-1!==s||r&&-1!==r)&&t({id:s,styleId:r,removes:[{index:[...Ft(this),o]}]}),l[i].deleteRule.apply(this,[o])}}),()=>{i.CSSStyleSheet.prototype.insertRule=o,i.CSSStyleSheet.prototype.deleteRule=s,r&&(i.CSSStyleSheet.prototype.replace=r),a&&(i.CSSStyleSheet.prototype.replaceSync=a),Object.entries(c).forEach(([t,e])=>{e.prototype.insertRule=l[t].insertRule,e.prototype.deleteRule=l[t].deleteRule})}}(t,{win:n}),u=Bt(t,t.doc),h=function({styleDeclarationCb:t,mirror:e,ignoreCSSAttributes:n,stylesheetManager:i},{win:o}){const s=o.CSSStyleDeclaration.prototype.setProperty;o.CSSStyleDeclaration.prototype.setProperty=function(o,r,a){var c;if(n.has(o))return s.apply(this,[o,r,a]);const{id:l,styleId:d}=xt(null===(c=this.parentRule)||void 0===c?void 0:c.parentStyleSheet,e,i.styleMirror);return(l&&-1!==l||d&&-1!==d)&&t({id:l,styleId:d,set:{property:o,value:r,priority:a},index:Ft(this.parentRule)}),s.apply(this,[o,r,a])};const r=o.CSSStyleDeclaration.prototype.removeProperty;return o.CSSStyleDeclaration.prototype.removeProperty=function(o){var s;if(n.has(o))return r.apply(this,[o]);const{id:a,styleId:c}=xt(null===(s=this.parentRule)||void 0===s?void 0:s.parentStyleSheet,e,i.styleMirror);return(a&&-1!==a||c&&-1!==c)&&t({id:a,styleId:c,remove:{property:o},index:Ft(this.parentRule)}),r.apply(this,[o])},()=>{o.CSSStyleDeclaration.prototype.setProperty=s,o.CSSStyleDeclaration.prototype.removeProperty=r}}(t,{win:n}),g=t.collectFonts?function({fontCb:t,doc:e}){const n=e.defaultView;if(!n)return()=>{};const i=[],o=new WeakMap,s=n.FontFace;n.FontFace=function(t,e,n){const i=new s(t,e,n);return o.set(i,{family:t,buffer:"string"!=typeof e,descriptors:n,fontSource:"string"==typeof e?e:JSON.stringify(Array.from(new Uint8Array(e)))}),i};const r=X(e.fonts,"add",function(e){return function(n){return setTimeout(()=>{const e=o.get(n);e&&(t(e),o.delete(n))},0),e.apply(this,[n])}});return i.push(()=>{n.FontFace=s}),i.push(r),()=>{i.forEach(t=>t())}}(t):()=>{},m=function(t){const{doc:e,mirror:n,blockClass:i,blockSelector:o,selectionCb:s}=t;let r=!0;const a=()=>{const t=e.getSelection();if(!t||r&&(null==t?void 0:t.isCollapsed))return;r=t.isCollapsed||!1;const a=[],c=t.rangeCount||0;for(let e=0;e<c;e++){const s=t.getRangeAt(e),{startContainer:r,startOffset:c,endContainer:l,endOffset:d}=s;et(r,i,o,!0)||et(l,i,o,!0)||a.push({start:n.getId(r),startOffset:c,end:n.getId(l),endOffset:d})}s({ranges:a})};return a(),Y("selectionchange",a)}(t),p=[];for(const e of t.plugins)p.push(e.observer(e.callback,n,e.options));return()=>{St.forEach(t=>t.reset()),i.disconnect(),o(),s(),r(),a(),c(),l(),d(),u(),h(),g(),m(),p.forEach(t=>t())}}class Vt{constructor(t){this.generateIdFn=t,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(t,e,n,i){const o=n||this.getIdToRemoteIdMap(t),s=i||this.getRemoteIdToIdMap(t);let r=o.get(e);return r||(r=this.generateIdFn(),o.set(e,r),s.set(r,e)),r}getIds(t,e){const n=this.getIdToRemoteIdMap(t),i=this.getRemoteIdToIdMap(t);return e.map(e=>this.getId(t,e,n,i))}getRemoteId(t,e,n){const i=n||this.getRemoteIdToIdMap(t);if("number"!=typeof e)return e;const o=i.get(e);return o||-1}getRemoteIds(t,e){const n=this.getRemoteIdToIdMap(t);return e.map(e=>this.getRemoteId(t,e,n))}reset(t){if(!t)return this.iframeIdToRemoteIdMap=new WeakMap,void(this.iframeRemoteIdToIdMap=new WeakMap);this.iframeIdToRemoteIdMap.delete(t),this.iframeRemoteIdToIdMap.delete(t)}getIdToRemoteIdMap(t){let e=this.iframeIdToRemoteIdMap.get(t);return e||(e=new Map,this.iframeIdToRemoteIdMap.set(t,e)),e}getRemoteIdToIdMap(t){let e=this.iframeRemoteIdToIdMap.get(t);return e||(e=new Map,this.iframeRemoteIdToIdMap.set(t,e)),e}}class Gt{constructor(t){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new Vt(O),this.mutationCb=t.mutationCb,this.wrappedEmit=t.wrappedEmit,this.stylesheetManager=t.stylesheetManager,this.recordCrossOriginIframes=t.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new Vt(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=t.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(t){this.iframes.set(t,!0),t.contentWindow&&this.crossOriginIframeMap.set(t.contentWindow,t)}addLoadListener(t){this.loadListener=t}attachIframe(t,e){var n;this.mutationCb({adds:[{parentId:this.mirror.getId(t),nextId:null,node:e}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null===(n=this.loadListener)||void 0===n||n.call(this,t),t.contentDocument&&t.contentDocument.adoptedStyleSheets&&t.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(t.contentDocument.adoptedStyleSheets,this.mirror.getId(t.contentDocument))}handleMessage(t){if("rrweb"===t.data.type){if(!t.source)return;const e=this.crossOriginIframeMap.get(t.source);if(!e)return;const n=this.transformCrossOriginEvent(e,t.data.event);n&&this.wrappedEmit(n,t.data.isCheckout)}}transformCrossOriginEvent(t,e){var n;switch(e.type){case lt.FullSnapshot:return this.crossOriginIframeMirror.reset(t),this.crossOriginIframeStyleMirror.reset(t),this.replaceIdOnNode(e.data.node,t),{timestamp:e.timestamp,type:lt.IncrementalSnapshot,data:{source:dt.Mutation,adds:[{parentId:this.mirror.getId(t),nextId:null,node:e.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}};case lt.Meta:case lt.Load:case lt.DomContentLoaded:return!1;case lt.Plugin:return e;case lt.Custom:return this.replaceIds(e.data.payload,t,["id","parentId","previousId","nextId"]),e;case lt.IncrementalSnapshot:switch(e.data.source){case dt.Mutation:return e.data.adds.forEach(e=>{this.replaceIds(e,t,["parentId","nextId","previousId"]),this.replaceIdOnNode(e.node,t)}),e.data.removes.forEach(e=>{this.replaceIds(e,t,["parentId","id"])}),e.data.attributes.forEach(e=>{this.replaceIds(e,t,["id"])}),e.data.texts.forEach(e=>{this.replaceIds(e,t,["id"])}),e;case dt.Drag:case dt.TouchMove:case dt.MouseMove:return e.data.positions.forEach(e=>{this.replaceIds(e,t,["id"])}),e;case dt.ViewportResize:return!1;case dt.MediaInteraction:case dt.MouseInteraction:case dt.Scroll:case dt.CanvasMutation:case dt.Input:return this.replaceIds(e.data,t,["id"]),e;case dt.StyleSheetRule:case dt.StyleDeclaration:return this.replaceIds(e.data,t,["id"]),this.replaceStyleIds(e.data,t,["styleId"]),e;case dt.Font:return e;case dt.Selection:return e.data.ranges.forEach(e=>{this.replaceIds(e,t,["start","end"])}),e;case dt.AdoptedStyleSheet:return this.replaceIds(e.data,t,["id"]),this.replaceStyleIds(e.data,t,["styleIds"]),null===(n=e.data.styles)||void 0===n||n.forEach(e=>{this.replaceStyleIds(e,t,["styleId"])}),e}}}replace(t,e,n,i){for(const o of i)(Array.isArray(e[o])||"number"==typeof e[o])&&(Array.isArray(e[o])?e[o]=t.getIds(n,e[o]):e[o]=t.getId(n,e[o]));return e}replaceIds(t,e,n){return this.replace(this.crossOriginIframeMirror,t,e,n)}replaceStyleIds(t,e,n){return this.replace(this.crossOriginIframeStyleMirror,t,e,n)}replaceIdOnNode(t,e){this.replaceIds(t,e,["id"]),"childNodes"in t&&t.childNodes.forEach(t=>{this.replaceIdOnNode(t,e)})}}class Zt{constructor(t){this.shadowDoms=new WeakSet,this.restorePatches=[],this.mutationCb=t.mutationCb,this.scrollCb=t.scrollCb,this.bypassOptions=t.bypassOptions,this.mirror=t.mirror;const e=this;this.restorePatches.push(X(Element.prototype,"attachShadow",function(t){return function(n){const i=t.call(this,n);return this.shadowRoot&&e.addShadowRoot(this.shadowRoot,this.ownerDocument),i}}))}addShadowRoot(t,e){b(t)&&(this.shadowDoms.has(t)||(this.shadowDoms.add(t),Et(Object.assign(Object.assign({},this.bypassOptions),{doc:e,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),t),Rt(Object.assign(Object.assign({},this.bypassOptions),{scrollCb:this.scrollCb,doc:t,mirror:this.mirror})),setTimeout(()=>{t.adoptedStyleSheets&&t.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(t.adoptedStyleSheets,this.mirror.getId(t.host)),Bt({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},t)},0)))}observeAttachShadow(t){if(t.contentWindow){const e=this;this.restorePatches.push(X(t.contentWindow.HTMLElement.prototype,"attachShadow",function(n){return function(i){const o=n.call(this,i);return this.shadowRoot&&e.addShadowRoot(this.shadowRoot,t.contentDocument),o}}))}}reset(){this.restorePatches.forEach(t=>t()),this.shadowDoms=new WeakSet}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function Ut(t,e,n,i){return new(n||(n=Promise))(function(e,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function r(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(s,r)}a((i=i.apply(t,[])).next())})}for(var Kt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_t="undefined"==typeof Uint8Array?[]:new Uint8Array(256),qt=0;qt<64;qt++)_t[Kt.charCodeAt(qt)]=qt;const zt=new Map;const Pt=(t,e,n)=>{if(!t||!Qt(t,e)&&"object"!=typeof t)return;const i=function(t,e){let n=zt.get(t);return n||(n=new Map,zt.set(t,n)),n.has(e)||n.set(e,[]),n.get(e)}(n,t.constructor.name);let o=i.indexOf(t);return-1===o&&(o=i.length,i.push(t)),o};function Yt(t,e,n){if(t instanceof Array)return t.map(t=>Yt(t,e,n));if(null===t)return t;if(t instanceof Float32Array||t instanceof Float64Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Int8Array||t instanceof Uint8ClampedArray){return{rr_type:t.constructor.name,args:[Object.values(t)]}}if(t instanceof ArrayBuffer){const e=t.constructor.name,n=function(t){var e,n=new Uint8Array(t),i=n.length,o="";for(e=0;e<i;e+=3)o+=Kt[n[e]>>2],o+=Kt[(3&n[e])<<4|n[e+1]>>4],o+=Kt[(15&n[e+1])<<2|n[e+2]>>6],o+=Kt[63&n[e+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o}(t);return{rr_type:e,base64:n}}if(t instanceof DataView){return{rr_type:t.constructor.name,args:[Yt(t.buffer,e,n),t.byteOffset,t.byteLength]}}if(t instanceof HTMLImageElement){const e=t.constructor.name,{src:n}=t;return{rr_type:e,src:n}}if(t instanceof HTMLCanvasElement){return{rr_type:"HTMLImageElement",src:t.toDataURL()}}if(t instanceof ImageData){return{rr_type:t.constructor.name,args:[Yt(t.data,e,n),t.width,t.height]}}if(Qt(t,e)||"object"==typeof t){return{rr_type:t.constructor.name,index:Pt(t,e,n)}}return t}const Jt=(t,e,n)=>[...t].map(t=>Yt(t,e,n)),Qt=(t,e)=>{const n=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter(t=>"function"==typeof e[t]);return Boolean(n.find(n=>t instanceof e[n]))};function Ht(t,e,n){const i=[];try{const o=X(t.HTMLCanvasElement.prototype,"getContext",function(t){return function(i,...o){return et(this,e,n,!0)||"__context"in this||(this.__context=i),t.apply(this,[i,...o])}});i.push(o)}catch(t){console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{i.forEach(t=>t())}}function jt(t,e,n,i,o,s,r){const a=[],c=Object.getOwnPropertyNames(t);for(const s of c)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(s))try{if("function"!=typeof t[s])continue;const c=X(t,s,function(t){return function(...a){const c=t.apply(this,a);if(Pt(c,r,this),!et(this.canvas,i,o,!0)){const t=Jt([...a],r,this),i={type:e,property:s,args:t};n(this.canvas,i)}return c}});a.push(c)}catch(i){const o=j(t,s,{set(t){n(this.canvas,{type:e,property:s,args:[t],setter:!0})}});a.push(o)}return a}var Xt=null;try{var $t="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __non_webpack_require__&&__non_webpack_require__("worker_threads")||"function"==typeof require&&require("worker_threads");Xt=$t.Worker}catch(t){}function te(t,e,n){var i=function(t){return Buffer.from(t,"base64").toString("utf8")}(t),o=i.indexOf("\n",10)+1,s=i.substring(o)+"";return function(t){return new Xt(s,Object.assign({},t,{eval:!0}))}}function ee(t,e,n){var i=function(t){return atob(t)}(t),o=i.indexOf("\n",10)+1,s=i.substring(o)+"",r=new Blob([s],{type:"application/javascript"});return URL.createObjectURL(r)}var ne="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);var ie,oe=(ie="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55DQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLg0KDQogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkNCiAgICBBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsDQogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1INCiAgICBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SDQogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KDQogICAgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgICAgICB9KTsNCiAgICB9CgogICAgLyoKICAgICAqIGJhc2U2NC1hcnJheWJ1ZmZlciAxLjAuMSA8aHR0cHM6Ly9naXRodWIuY29tL25pa2xhc3ZoL2Jhc2U2NC1hcnJheWJ1ZmZlcj4KICAgICAqIENvcHlyaWdodCAoYykgMjAyMSBOaWtsYXMgdm9uIEhlcnR6ZW4gPGh0dHBzOi8vaGVydHplbi5jb20+CiAgICAgKiBSZWxlYXNlZCB1bmRlciBNSVQgTGljZW5zZQogICAgICovCiAgICB2YXIgY2hhcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyc7CiAgICAvLyBVc2UgYSBsb29rdXAgdGFibGUgdG8gZmluZCB0aGUgaW5kZXguCiAgICB2YXIgbG9va3VwID0gdHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gW10gOiBuZXcgVWludDhBcnJheSgyNTYpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgIGxvb2t1cFtjaGFycy5jaGFyQ29kZUF0KGkpXSA9IGk7CiAgICB9CiAgICB2YXIgZW5jb2RlID0gZnVuY3Rpb24gKGFycmF5YnVmZmVyKSB7CiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpLCBpLCBsZW4gPSBieXRlcy5sZW5ndGgsIGJhc2U2NCA9ICcnOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMykgewogICAgICAgICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaV0gPj4gMl07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1soKGJ5dGVzW2ldICYgMykgPDwgNCkgfCAoYnl0ZXNbaSArIDFdID4+IDQpXTsKICAgICAgICAgICAgYmFzZTY0ICs9IGNoYXJzWygoYnl0ZXNbaSArIDFdICYgMTUpIDw8IDIpIHwgKGJ5dGVzW2kgKyAyXSA+PiA2KV07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1tieXRlc1tpICsgMl0gJiA2M107CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgJz0nOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgJz09JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhc2U2NDsKICAgIH07CgogICAgY29uc3QgbGFzdEJsb2JNYXAgPSBuZXcgTWFwKCk7DQogICAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gbmV3IE1hcCgpOw0KICAgIGZ1bmN0aW9uIGdldFRyYW5zcGFyZW50QmxvYkZvcih3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucykgew0KICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgew0KICAgICAgICAgICAgY29uc3QgaWQgPSBgJHt3aWR0aH0tJHtoZWlnaHR9YDsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW50QmxvYk1hcC5oYXMoaWQpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNwYXJlbnRCbG9iTWFwLmdldChpZCk7DQogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBvZmZzY3JlZW4uZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0geWllbGQgYmxvYi5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7DQogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnRCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgY29uc3Qgd29ya2VyID0gc2VsZjsNCiAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgeyBpZCwgYml0bWFwLCB3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucyB9ID0gZS5kYXRhOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IG9mZnNjcmVlbi5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwKTsNCiAgICAgICAgICAgICAgICBiaXRtYXAuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBibG9iLnR5cGU7DQogICAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSB5aWVsZCBibG9iLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICAgICAgY29uc3QgYmFzZTY0ID0gZW5jb2RlKGFycmF5QnVmZmVyKTsNCiAgICAgICAgICAgICAgICBpZiAoIWxhc3RCbG9iTWFwLmhhcyhpZCkgJiYgKHlpZWxkIHRyYW5zcGFyZW50QmFzZTY0KSA9PT0gYmFzZTY0KSB7DQogICAgICAgICAgICAgICAgICAgIGxhc3RCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7DQogICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICAgICAgICAgaWQsDQogICAgICAgICAgICAgICAgICAgIHR5cGUsDQogICAgICAgICAgICAgICAgICAgIGJhc2U2NCwNCiAgICAgICAgICAgICAgICAgICAgd2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfTsKCn0pKCk7Cgo=",ne?te(ie):function(t){var e;return function(n){return e=e||ee(t),new Worker(e,n)}}(ie));class se{constructor(t){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=(t,e)=>{!(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId)&&this.rafStamps.invokeId||(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(t)||this.pendingCanvasMutations.set(t,[]),this.pendingCanvasMutations.get(t).push(e)};const{sampling:e="all",win:n,blockClass:i,blockSelector:o,recordCanvas:s,dataURLOptions:r}=t;this.mutationCb=t.mutationCb,this.mirror=t.mirror,s&&"all"===e&&this.initCanvasMutationObserver(n,i,o),s&&"number"==typeof e&&this.initCanvasFPSObserver(e,n,i,o,{dataURLOptions:r})}reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}initCanvasFPSObserver(t,e,n,i,o){const s=Ht(e,n,i),r=new Map,a=new oe;a.onmessage=t=>{const{id:e}=t.data;if(r.set(e,!1),!("base64"in t.data))return;const{base64:n,type:i,width:o,height:s}=t.data;this.mutationCb({id:e,type:ht["2D"],commands:[{property:"clearRect",args:[0,0,o,s]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:n}],type:i}]},0,0]}]})};const c=1e3/t;let l,d=0;const u=t=>{d&&t-d<c||(d=t,(()=>{const t=[];return e.document.querySelectorAll("canvas").forEach(e=>{et(e,n,i,!0)||t.push(e)}),t})().forEach(t=>Ut(this,0,void 0,function*(){var e;const n=this.mirror.getId(t);if(r.get(n))return;if(r.set(n,!0),["webgl","webgl2"].includes(t.__context)){const n=t.getContext(t.__context);!1===(null===(e=null==n?void 0:n.getContextAttributes())||void 0===e?void 0:e.preserveDrawingBuffer)&&(null==n||n.clear(n.COLOR_BUFFER_BIT))}const i=yield createImageBitmap(t);a.postMessage({id:n,bitmap:i,width:t.width,height:t.height,dataURLOptions:o.dataURLOptions},[i])}))),l=requestAnimationFrame(u)};l=requestAnimationFrame(u),this.resetObservers=()=>{s(),cancelAnimationFrame(l)}}initCanvasMutationObserver(t,e,n){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();const i=Ht(t,e,n),o=function(t,e,n,i){const o=[],s=Object.getOwnPropertyNames(e.CanvasRenderingContext2D.prototype);for(const r of s)try{if("function"!=typeof e.CanvasRenderingContext2D.prototype[r])continue;const s=X(e.CanvasRenderingContext2D.prototype,r,function(o){return function(...s){return et(this.canvas,n,i,!0)||setTimeout(()=>{const n=Jt([...s],e,this);t(this.canvas,{type:ht["2D"],property:r,args:n})},0),o.apply(this,s)}});o.push(s)}catch(n){const i=j(e.CanvasRenderingContext2D.prototype,r,{set(e){t(this.canvas,{type:ht["2D"],property:r,args:[e],setter:!0})}});o.push(i)}return()=>{o.forEach(t=>t())}}(this.processMutation.bind(this),t,e,n),s=function(t,e,n,i){const o=[];return o.push(...jt(e.WebGLRenderingContext.prototype,ht.WebGL,t,n,i,0,e)),void 0!==e.WebGL2RenderingContext&&o.push(...jt(e.WebGL2RenderingContext.prototype,ht.WebGL2,t,n,i,0,e)),()=>{o.forEach(t=>t())}}(this.processMutation.bind(this),t,e,n,this.mirror);this.resetObservers=()=>{i(),o(),s()}}startPendingCanvasMutationFlusher(){requestAnimationFrame(()=>this.flushPendingCanvasMutations())}startRAFTimestamping(){const t=e=>{this.rafStamps.latestId=e,requestAnimationFrame(t)};requestAnimationFrame(t)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach((t,e)=>{const n=this.mirror.getId(e);this.flushPendingCanvasMutationFor(e,n)}),requestAnimationFrame(()=>this.flushPendingCanvasMutations())}flushPendingCanvasMutationFor(t,e){if(this.frozen||this.locked)return;const n=this.pendingCanvasMutations.get(t);if(!n||-1===e)return;const i=n.map(t=>{const e=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(n[i[o]]=t[i[o]])}return n}(t,["type"]);return e}),{type:o}=n[0];this.mutationCb({id:e,type:o,commands:i}),this.pendingCanvasMutations.delete(t)}}class re{constructor(t){this.trackedLinkElements=new WeakSet,this.styleMirror=new ct,this.mutationCb=t.mutationCb,this.adoptedStyleSheetCb=t.adoptedStyleSheetCb}attachLinkElement(t,e){"_cssText"in e.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:e.id,attributes:e.attributes}]}),this.trackLinkElement(t)}trackLinkElement(t){this.trackedLinkElements.has(t)||(this.trackedLinkElements.add(t),this.trackStylesheetInLinkElement(t))}adoptStyleSheets(t,e){if(0===t.length)return;const n={id:e,styleIds:[]},i=[];for(const e of t){let t;if(this.styleMirror.has(e))t=this.styleMirror.getId(e);else{t=this.styleMirror.add(e);const n=Array.from(e.rules||CSSRule);i.push({styleId:t,rules:n.map((t,e)=>({rule:A(t),index:e}))})}n.styleIds.push(t)}i.length>0&&(n.styles=i),this.adoptedStyleSheetCb(n)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(t){}}function ae(t){return Object.assign(Object.assign({},t),{timestamp:Date.now()})}let ce,le,de,ue=!1;const he=new k;function ge(t={}){const{emit:e,checkoutEveryNms:n,checkoutEveryNth:i,blockClass:o="rr-block",blockSelector:s=null,ignoreClass:r="rr-ignore",maskTextClass:a="rr-mask",maskTextSelector:c=null,inlineStylesheet:l=!0,maskAllInputs:d,maskInputOptions:u,slimDOMOptions:h,maskInputFn:g,maskTextFn:m,hooks:p,packFn:I,sampling:C={},dataURLOptions:y={},mousemoveWait:f,recordCanvas:v=!1,recordCrossOriginIframes:b=!1,userTriggeredOnInput:S=!1,collectFonts:A=!1,inlineImages:w=!1,plugins:M,keepIframeSrcFn:T=()=>!1,ignoreCSSAttributes:E=new Set([])}=t,N=!b||window.parent===window;let R=!1;if(!N)try{window.parent.document,R=!1}catch(t){R=!0}if(N&&!e)throw new Error("emit function is required");void 0!==f&&void 0===C.mousemove&&(C.mousemove=f),he.reset();const O=!0===d?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:void 0!==u?u:{password:!0},L=!0===h||"all"===h?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===h,headMetaDescKeywords:"all"===h}:h||{};let D;!function(t=window){"NodeList"in t&&!t.NodeList.prototype.forEach&&(t.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in t&&!t.DOMTokenList.prototype.forEach&&(t.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...t)=>{let e=t[0];if(!(0 in t))throw new TypeError("1 argument is required");do{if(this===e)return!0}while(e=e&&e.parentNode);return!1})}();let F=0;const x=t=>{for(const e of M||[])e.eventProcessor&&(t=e.eventProcessor(t));return I&&(t=I(t)),t};ce=(t,o)=>{var s;if(!(null===(s=St[0])||void 0===s?void 0:s.isFrozen())||t.type===lt.FullSnapshot||t.type===lt.IncrementalSnapshot&&t.data.source===dt.Mutation||St.forEach(t=>t.unfreeze()),N)null==e||e(x(t),o);else if(R){const e={type:"rrweb",event:x(t),isCheckout:o};window.parent.postMessage(e,"*")}if(t.type===lt.FullSnapshot)D=t,F=0;else if(t.type===lt.IncrementalSnapshot){if(t.data.source===dt.Mutation&&t.data.isAttachIframe)return;F++;const e=i&&F>=i,o=n&&t.timestamp-D.timestamp>n;(e||o)&&le(!0)}};const B=t=>{ce(ae({type:lt.IncrementalSnapshot,data:Object.assign({source:dt.Mutation},t)}))},W=t=>ce(ae({type:lt.IncrementalSnapshot,data:Object.assign({source:dt.Scroll},t)})),V=t=>ce(ae({type:lt.IncrementalSnapshot,data:Object.assign({source:dt.CanvasMutation},t)})),G=new re({mutationCb:B,adoptedStyleSheetCb:t=>ce(ae({type:lt.IncrementalSnapshot,data:Object.assign({source:dt.AdoptedStyleSheet},t)}))}),Z=new Gt({mirror:he,mutationCb:B,stylesheetManager:G,recordCrossOriginIframes:b,wrappedEmit:ce});for(const t of M||[])t.getMirror&&t.getMirror({nodeMirror:he,crossOriginIframeMirror:Z.crossOriginIframeMirror,crossOriginIframeStyleMirror:Z.crossOriginIframeStyleMirror});de=new se({recordCanvas:v,mutationCb:V,win:window,blockClass:o,blockSelector:s,mirror:he,sampling:C.canvas,dataURLOptions:y});const U=new Zt({mutationCb:B,scrollCb:W,bypassOptions:{blockClass:o,blockSelector:s,maskTextClass:a,maskTextSelector:c,inlineStylesheet:l,maskInputOptions:O,dataURLOptions:y,maskTextFn:m,maskInputFn:g,recordCanvas:v,inlineImages:w,sampling:C,slimDOMOptions:L,iframeManager:Z,stylesheetManager:G,canvasManager:de,keepIframeSrcFn:T},mirror:he});le=(t=!1)=>{var e,n,i,r,d,u;ce(ae({type:lt.Meta,data:{href:window.location.href,width:tt(),height:$()}}),t),G.reset(),St.forEach(t=>t.lock());const h=function(t,e){var n=e||{},i=n.mirror,o=void 0===i?new k:i,s=n.blockClass,r=void 0===s?"rr-block":s,a=n.blockSelector,c=void 0===a?null:a,l=n.maskTextClass,d=void 0===l?"rr-mask":l,u=n.maskTextSelector,h=void 0===u?null:u,g=n.inlineStylesheet,m=void 0===g||g,p=n.inlineImages,I=void 0!==p&&p,C=n.recordCanvas,y=void 0!==C&&C,f=n.maskAllInputs,v=void 0!==f&&f,b=n.maskTextFn,S=n.maskInputFn,A=n.slimDOM,w=void 0!==A&&A,M=n.dataURLOptions,T=n.preserveWhiteSpace,E=n.onSerialize,N=n.onIframeLoad,R=n.iframeLoadTimeout,O=n.onStylesheetLoad,L=n.stylesheetLoadTimeout,D=n.keepIframeSrcFn;return P(t,{doc:t,mirror:o,blockClass:r,blockSelector:c,maskTextClass:d,maskTextSelector:h,skipChild:!1,inlineStylesheet:m,maskInputOptions:!0===v?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===v?{password:!0}:v,maskTextFn:b,maskInputFn:S,slimDOMOptions:!0===w||"all"===w?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===w,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===w?{}:w,dataURLOptions:M,inlineImages:I,recordCanvas:y,preserveWhiteSpace:T,onSerialize:E,onIframeLoad:N,iframeLoadTimeout:R,onStylesheetLoad:O,stylesheetLoadTimeout:L,keepIframeSrcFn:void 0===D?function(){return!1}:D,newlyAddedElement:!1})}(document,{mirror:he,blockClass:o,blockSelector:s,maskTextClass:a,maskTextSelector:c,inlineStylesheet:l,maskAllInputs:O,maskTextFn:m,slimDOM:L,dataURLOptions:y,recordCanvas:v,inlineImages:w,onSerialize:t=>{st(t,he)&&Z.addIframe(t),rt(t,he)&&G.trackLinkElement(t),at(t)&&U.addShadowRoot(t.shadowRoot,document)},onIframeLoad:(t,e)=>{Z.attachIframe(t,e),U.observeAttachShadow(t)},onStylesheetLoad:(t,e)=>{G.attachLinkElement(t,e)},keepIframeSrcFn:T});if(!h)return console.warn("Failed to snapshot the document");ce(ae({type:lt.FullSnapshot,data:{node:h,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null===document||void 0===document?void 0:document.documentElement.scrollLeft)||(null===(n=null===(e=null===document||void 0===document?void 0:document.body)||void 0===e?void 0:e.parentElement)||void 0===n?void 0:n.scrollLeft)||(null===(i=null===document||void 0===document?void 0:document.body)||void 0===i?void 0:i.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null===document||void 0===document?void 0:document.documentElement.scrollTop)||(null===(d=null===(r=null===document||void 0===document?void 0:document.body)||void 0===r?void 0:r.parentElement)||void 0===d?void 0:d.scrollTop)||(null===(u=null===document||void 0===document?void 0:document.body)||void 0===u?void 0:u.scrollTop)||0}}})),St.forEach(t=>t.unlock()),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&G.adoptStyleSheets(document.adoptedStyleSheets,he.getId(document))};try{const t=[];t.push(Y("DOMContentLoaded",()=>{ce(ae({type:lt.DomContentLoaded,data:{}}))}));const e=t=>{var e;return Wt({mutationCb:B,mousemoveCb:(t,e)=>ce(ae({type:lt.IncrementalSnapshot,data:{source:e,positions:t}})),mouseInteractionCb:t=>ce(ae({type:lt.IncrementalSnapshot,data:Object.assign({source:dt.MouseInteraction},t)})),scrollCb:W,viewportResizeCb:t=>ce(ae({type:lt.IncrementalSnapshot,data:Object.assign({source:dt.ViewportResize},t)})),inputCb:t=>ce(ae({type:lt.IncrementalSnapshot,data:Object.assign({source:dt.Input},t)})),mediaInteractionCb:t=>ce(ae({type:lt.IncrementalSnapshot,data:Object.assign({source:dt.MediaInteraction},t)})),styleSheetRuleCb:t=>ce(ae({type:lt.IncrementalSnapshot,data:Object.assign({source:dt.StyleSheetRule},t)})),styleDeclarationCb:t=>ce(ae({type:lt.IncrementalSnapshot,data:Object.assign({source:dt.StyleDeclaration},t)})),canvasMutationCb:V,fontCb:t=>ce(ae({type:lt.IncrementalSnapshot,data:Object.assign({source:dt.Font},t)})),selectionCb:t=>{ce(ae({type:lt.IncrementalSnapshot,data:Object.assign({source:dt.Selection},t)}))},blockClass:o,ignoreClass:r,maskTextClass:a,maskTextSelector:c,maskInputOptions:O,inlineStylesheet:l,sampling:C,recordCanvas:v,inlineImages:w,userTriggeredOnInput:S,collectFonts:A,doc:t,maskInputFn:g,maskTextFn:m,keepIframeSrcFn:T,blockSelector:s,slimDOMOptions:L,dataURLOptions:y,mirror:he,iframeManager:Z,stylesheetManager:G,shadowDomManager:U,canvasManager:de,ignoreCSSAttributes:E,plugins:(null===(e=null==M?void 0:M.filter(t=>t.observer))||void 0===e?void 0:e.map(t=>({observer:t.observer,options:t.options,callback:e=>ce(ae({type:lt.Plugin,data:{plugin:t.name,payload:e}}))})))||[]},p)};Z.addLoadListener(n=>{t.push(e(n.contentDocument))});const n=()=>{le(),t.push(e(document)),ue=!0};return"interactive"===document.readyState||"complete"===document.readyState?n():t.push(Y("load",()=>{ce(ae({type:lt.Load,data:{}})),n()},window)),()=>{t.forEach(t=>t()),ue=!1}}catch(t){console.warn(t)}}ge.addCustomEvent=(t,e)=>{if(!ue)throw new Error("please add custom event after start recording");ce(ae({type:lt.Custom,data:{tag:t,payload:e}}))},ge.freezePage=()=>{St.forEach(t=>t.freeze())},ge.takeFullSnapshot=t=>{if(!ue)throw new Error("please take full snapshot after start recording");le(t)},ge.mirror=he;class me{constructor(t,e={}){this.stopFn=null,this.replayEvents=[],this.callback=t,this.config=e}getReplayEvents(){return[...this.replayEvents]}start(){var t,e,n,i,o,s,r;this.stopFn=null!==(r=ge({emit:(t,e)=>{e&&(this.replayEvents=[]),this.replayEvents.push(t),this.callback(t,e)},checkoutEveryNth:null!==(t=this.config.checkoutEveryNth)&&void 0!==t?t:200,checkoutEveryNms:this.config.checkoutEveryNms,maskAllInputs:null===(e=this.config.maskAllInputs)||void 0===e||e,blockClass:null!==(n=this.config.blockClass)&&void 0!==n?n:"rr-block",blockSelector:null!==(i=this.config.blockSelector)&&void 0!==i?i:void 0,maskTextClass:null!==(o=this.config.maskTextClass)&&void 0!==o?o:"rr-mask",recordCanvas:null!==(s=this.config.recordCanvas)&&void 0!==s&&s,sampling:this.config.sampling}))&&void 0!==r?r:null}stop(){this.stopFn&&(this.stopFn(),this.stopFn=null)}}class pe{constructor(t){this.clicks=[],this.handleClick=t=>{var e,n;const i=t.target;if(!i)return;const o={tagName:(null===(e=i.tagName)||void 0===e?void 0:e.toLowerCase())||"",id:i.id||"",className:i.className||"",name:i.name||"",text:this.getElementText(i),timestamp:Date.now()};"a"===(null===(n=i.tagName)||void 0===n?void 0:n.toLowerCase())&&(o.href=i.href||""),this.clicks.push(o),this.callback(o)},this.callback=t}start(){document.addEventListener("click",this.handleClick,!0)}stop(){document.removeEventListener("click",this.handleClick,!0)}getClicks(){return[...this.clicks]}clearClicks(){this.clicks=[]}getElementText(t){return(t.innerText||t.textContent||"").substring(0,100).trim()}}class Ie{constructor(t){this.flushInterval=null,this.config={endpoint:"/events",flushInterval:3e3,maxQueueSize:1e3,sessionTimeoutMinutes:30,trackSessionReplay:!0,trackDevice:!0,trackLocation:!1,trackPerformance:!0,trackBattery:!0,trackOrientation:!0,trackMotion:!1,trackTimeOnPage:!0,trackPermissions:!1,trackClicks:!0,debug:!1,...t};const e=this.initializeUser();this.userId=e.userId,this.isNewUser=e.isNewUser;const n=this.initializeSession();this.sessionId=n.sessionId,this.isNewSession=n.isNewSession,this.queue=new i(this.sessionId,this.userId,this.config.maxQueueSize),this.deviceCollector=new l,this.connectionCollector=new d,this.locationCollector=new u,this.performanceCollector=new h,this.permissionsCollector=new y,this.init()}initializeUser(){let t=c.getUserIdentity();return t?(t.lastSeenAt=Date.now(),c.setUserIdentity(t),this.log("Returning user detected",t),{userId:t.userId,isNewUser:!1}):(t={userId:e(),createdAt:Date.now(),visitCount:1,lastSeenAt:Date.now()},c.setUserIdentity(t),this.log("New user created",t),{userId:t.userId,isNewUser:!0})}initializeSession(){const t=60*this.config.sessionTimeoutMinutes*1e3;if(!c.isSessionExpired(t)){const t=c.getSessionData();return c.incrementPageViews(),this.log("Continuing existing session",t),{sessionId:t.sessionId,isNewSession:!1}}const n={sessionId:e(),startedAt:Date.now(),lastActivityAt:Date.now(),pageViews:1};return c.setSessionData(n),this.isNewUser||c.incrementVisitCount(),this.log("New session created",n),{sessionId:n.sessionId,isNewSession:!0}}init(){this.recoverEvents(),this.collectInitialData(),this.startCollectors(),this.setupActivityTracking(),this.flushInterval=setInterval(()=>this.flush(),this.config.flushInterval),this.setupUnloadHandlers(),this.log("Tracker initialized",this.config)}recoverEvents(){const t=c.getEvents();t.length>0&&(this.log(`Recovering ${t.length} events from storage`),this.queue.addRaw(t),c.clearEvents())}collectInitialData(){var t;if(this.config.trackDevice){const t=this.deviceCollector.collect();this.queue.add("device",t)}const e=this.connectionCollector.collect();if(e&&this.queue.add("connection",e),this.queue.add("pageview",{url:window.location.href,referrer:document.referrer,cameFrom:document.referrer,title:document.title,isNewSession:this.isNewSession,isNewUser:this.isNewUser,pageViewNumber:(null===(t=c.getSessionData())||void 0===t?void 0:t.pageViews)||1}),this.isNewUser&&this.queue.add("user_identified",{userId:this.userId,isFirstVisit:!0,identifiedAt:Date.now()}),this.isNewSession){const t=c.getUserIdentity();this.queue.add("session_started",{sessionId:this.sessionId,userId:this.userId,visitNumber:(null==t?void 0:t.visitCount)||1,startedAt:Date.now()})}this.config.trackPerformance&&window.addEventListener("load",()=>{setTimeout(()=>{const t=this.performanceCollector.collect();t&&this.queue.add("performance",t)},0)}),this.config.trackLocation&&this.collectLocation(),this.config.trackBattery&&this.collectBattery(),this.config.trackPermissions&&this.collectPermissions()}async collectLocation(){const t=await this.locationCollector.getGPSLocation();if(t)return void this.queue.add("location",t);const e=await this.locationCollector.getIPLocation();e&&this.queue.add("location",e)}async collectBattery(){this.batteryCollector=new m(t=>{this.queue.add("battery",t)});const t=await this.batteryCollector.collect();t&&(this.queue.add("battery",t),this.batteryCollector.start())}async collectPermissions(){const t=await this.permissionsCollector.collect();t&&this.queue.add("permissions",t)}startCollectors(){this.config.trackSessionReplay&&(this.sessionReplayCollector=new me((t,e)=>{const n=e?"rrweb_checkout":"rrweb";this.queue.add(n,t)},{checkoutEveryNth:200,maskAllInputs:!0}),this.sessionReplayCollector.start()),this.visibilityCollector=new g(t=>{this.queue.add("visibility",t)}),this.visibilityCollector.start(),this.config.trackOrientation&&(this.orientationCollector=new p(t=>{this.queue.add("orientation",t)}),this.orientationCollector.start()),this.config.trackMotion&&(this.motionCollector=new I(t=>{this.queue.add("motion",t)}),this.motionCollector.start()),this.config.trackTimeOnPage&&(this.timeOnPageCollector=new C(t=>{this.queue.add("time_on_page",t)}),this.timeOnPageCollector.start()),this.config.trackClicks&&(this.clickCollector=new pe(t=>{this.queue.add("click",t)}),this.clickCollector.start())}setupActivityTracking(){["click","keydown","scroll","touchstart"].forEach(t=>{document.addEventListener(t,()=>{c.updateSessionActivity()},{passive:!0,capture:!0})})}setupUnloadHandlers(){document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&(this.captureTimeOnPage(),this.persist(),this.flush(!0))}),window.addEventListener("beforeunload",()=>{this.captureTimeOnPage(),this.persist(),this.flush(!0)}),window.addEventListener("pagehide",()=>{this.captureTimeOnPage(),this.persist(),this.flush(!0)})}captureTimeOnPage(){this.timeOnPageCollector&&this.queue.add("time_on_page",this.timeOnPageCollector.collect())}persist(){this.queue.isEmpty()||c.saveEvents(this.queue.getAll())}flush(t=!1){if(this.queue.isEmpty())return;const e=this.queue.flush();this.send(e,t)}send(t,e=!1){const n={apiKey:this.config.apiKey,sessionId:this.sessionId,userId:this.userId,events:t};this.log(`Flushing ${t.length} events`,n);const i=JSON.stringify(n);if(e&&"function"==typeof navigator.sendBeacon)return navigator.sendBeacon(this.config.endpoint,new Blob([i],{type:"application/json"})),void c.clearEvents();fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:i}).then(e=>{if(!e.ok)return this.log(`Failed to send events: ${e.status}`),void c.saveEvents(t);c.clearEvents(),this.log(`Successfully sent ${t.length} events`)}).catch(e=>{this.log("Network error, persisting events for retry",e),c.saveEvents(t)})}track(t,e){this.queue.add(t,e)}identify(t,e){this.queue.add("identify",{userId:t,traits:e})}destroy(){var t,e,n,i,o,s;this.flushInterval&&clearInterval(this.flushInterval),null===(t=this.sessionReplayCollector)||void 0===t||t.stop(),null===(e=this.visibilityCollector)||void 0===e||e.stop(),null===(n=this.batteryCollector)||void 0===n||n.stop(),null===(i=this.orientationCollector)||void 0===i||i.stop(),null===(o=this.motionCollector)||void 0===o||o.stop(),null===(s=this.clickCollector)||void 0===s||s.stop(),this.timeOnPageCollector&&(this.queue.add("time_on_page",this.timeOnPageCollector.collect()),this.timeOnPageCollector.stop()),this.flush()}log(...t){this.config.debug&&console.log("[Tracker]",...t)}}let Ce=null;return window.Tracker={init:t=>(Ce&&(Ce.destroy(),Ce=null),Ce=new Ie(t),Ce),getInstance:()=>Ce},t.Tracker=Ie,t}({});
